---
title: FPS基础技术
date: 2025-01-18 10:00:24
tags:
---

# 什么是FPS游戏？
第一人称射击
最早的FPS：德军总部3D
最早商业引擎开发的FPS：DOOM

# 框架基础
武器、3C（角色、控制、相机）、玩法、地图

Weapon - 3C - Gameplay
Game System（管理游戏内部模块，例如网络、商业化系统）
Game Core（核心封装） - Third Party Library（开源/商业库）
Game Engine
Operating System

![alt text](image.png)

# 武器系统
武器类型：主武器、副武器、道具、投掷物、近战、护甲
技术上一般按功能做抽象区分，如InstantHit（即时命中）、Projectile（投掷物）

需要：
- 物理引擎（PhysX、havok、Bullitt）：做命中判定、场景碰撞、布料模拟
![弹道](image2.png)
- 弹道模型：影响弹道的因素？主弹道子弹射出方向 = 主视角角度+后坐力+精准度+散发度。除了视角之外，其他都是策划配表通过公式得出的
    - 主视角角度
    ![后坐力](image4.png)
    - 后坐力（反向冲击力导致枪向上抬、左右摇摆）：影响最大的因素，一般有个最大限制
    ![连发](image3.png)
    - 连发数（叠加 or 回复）
    - 精准度（武器制作工艺差别）：散发方向 = 随机数*散发度*水平/垂直方向
    - 散发度（人体是否稳定？）

## InstantHit Weapon（10：33）
![开火流程](image5.png)

## 武器系统
继承：
![武器系统-继承](image6.png)

组合（通过组件）：
![武器系统-组合](image7.png)

武器状态机：
![状态机](image8.png)
一个状态机有多个状态（组合）：
![alt text](image9.png)

# 3C系统（10：40）

## Character
Character：角色，具有一定的能力或行为，玩家可以进行扮演或观察

表现方面：角色网格模型 + 贴图 + 材质 + 动画 + 物理设置（Avatar/布偶）+ 特效 + 音效
技术要点：
    - 逻辑
    - 状态的设计和转换（动画状态机）


## Camera
Camera：相机，通过它观察游戏世界，获得体验感和沉浸感

技术要点：
    - 渲染顺序（防止穿模）
    - FOV（画面信息）
    - 碰撞、位置控制
    - 屏幕特效（抖动、震撼）

## Control
Control：控制，玩家通过它观察游戏世界，获得体验感和沉浸感

技术要点：
    - 设备（输入输出）与手感（震动反馈、dpi）
        - 手游适配问题：
            1. ios与安卓灵敏度不同
            2. 安卓内部的灵敏度差异也很大，部分灵敏度偏低
    - 辅助瞄准：有阻尼，只是吸附到一定范围，不是锁头挂
    - 硬件功能：陀螺仪、3D Touch等

# Gameplay

# 其他技术
## 网络同步（11：07）
fps：状态同步
客户端预表现 or 等服务器确认？：由于上行延迟和下行延迟，预表现是必要的

Peeker’s Advantage：移动的更有优势还是静止的玩家更有优势？
答案是移动的更有优势，因为延时的存在（可以找一篇文章看：Peeking into VALORANT's Netcode）

## 反外挂（11：23）
![外挂类型](image10.png)

![作弊原理](image11.png)

- 服务器校验：对于关键逻辑需要在服务端进行校验
- 服务器数据下发
- 客户端数据加密
- 客户端动态监测

## 性能优化
![性能优化体系](image12.png)

物理上：只使用物理的数据（例如包围盒数据）、子弹方向去计算命中，而不是用物理计算（这样也能保证确定性）

动画上：
    - 计算骨骼投影大小 -> 更新 LOD -> 更新动画（降低播放频率）
    - 遮挡剔除

渲染上：视锥裁剪（出怪点）、距离裁剪（枪火特效）、LOD、遮挡剔除（弹孔贴花）

GPU Skinning：把更多计算放到GPU。




延迟补偿