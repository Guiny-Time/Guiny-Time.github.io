---
layout: post
title: 排序算法之拓扑排序
date: 2024-03-26 12:39:10
tags: ['算法与数据结构','算法','计算机科学技术','面试相关']
categories: 算法与数据结构
copyright_author: 时光
hidden: true
---

这一部分其实可以放到**图论**的章节详细介绍，但最近在做排序相关的题目时经常遇到这类问题，因此单独拎出来先讲一讲。

先看定义：

> **有向图**的**拓扑排序**是对其**顶点**的一种线性排序，使得对于从顶点 A 到顶点 B 的每个有向边 AB ，A 在排序中都在 B 之前。当且仅当图中没有定向环时（即**有向无环图**），才有可能进行拓扑排序。

在图论中，**有向图**指的是边为有方向的图。如果一个有向图从任意顶点出发无法经过若干条边回到该点，则这个图是一个**有向无环图**(DAG)。下面是一个有向无环图的例子。

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/39/Directed_acyclic_graph_3.svg/1280px-Directed_acyclic_graph_3.svg.png" width=300>

下面是一个存在环的有向图的例子，其中包括了指向节点本身的**自环**（如顶点1）和两个节点之间的**环**（如顶点2、3）。这种存在环结构的有向图不在拓扑排序的考虑范围内。

<img src="https://thatdarndata.com/wp-content/uploads/2022/01/Screen-Shot-2022-01-10-at-1.36.58-PM-1024x781.png" width=350>

拓扑排序要解决的问题是给一个有向无环图的所有节点排序，其目标是将所有节点排序，使得排在前面的节点不能**依赖于**排在后面的节点。

{% note info **依赖** 与 **间接依赖** %}
给定一个有向无环图，如果从顶点 i 到 j 有边，则认为 j **依赖于** i。
如果 i 到 j 有路径（i 可达 j），则称 j **间接依赖于** i。
在上面的 DAG 例子中，我们可以说顶点 11 依赖于顶点 5，顶点 9 间接依赖于顶点 5。
{% endnote %}

# 构造拓扑序列
对于一个 DAG，我们可以通过以下方式构造拓扑序列：

1. 从图中选择一个入度为零的点。
2. 输出该顶点，从图中删除此顶点及其所有的出边。

重复上面两步，直到所有顶点都输出，拓扑排序完成。如果图中不存在**入度为零**的点，此时说明图是有环图，拓扑排序无法完成，陷入死锁。

{% note info **入度** 和 **出度** %}
在图论中，一个顶点在图中的**度** (degree)为与这个顶点相连接的边的数目。
通俗来说，**入度**指有多少条边指向该顶点。在上面的 DAG 例子中，顶点 5 的入度为 0；顶点 11 的入度为 2。
与之相对的，**出度**指从顶点出发的边的条数。在上面的 DAG 例子中，顶点 5 的出度为 1；顶点 11 的出度为 3。
{% endnote %}

{% note success 小练习：寻找DAG中的拓扑序列 %}

<img src="https://img14.360buyimg.com/ddimg/jfs/t1/173132/15/42415/10549/66025cfdF6429d1a1/58688666483b7d9e.jpg" alt="image.png" title="image.png" />

遵循上述方法，我们先搜索 DAG 中入度为 0 的顶点，有{% label warning @顶点1 %}和{% label primary @顶点2 %}。是的，从这里就可以看出一张 DAG 其实可以有多个排序结果，与我们选择哪个顶点有关。
我们可以选择{% label warning @顶点1 %}。现在在图中删除{% label warning @顶点1 %}和从{% label warning @顶点1 %}出发的两条边，DAG中出度为 0 的顶点就只剩下{% label primary @顶点2 %}了。
删除{% label primary @顶点2 %}，DAG中出度为 0 的顶点只有{% label success @顶点3 %}。
删除{% label success @顶点3 %}，DAG中出度为 0 的顶点只有{% label info @顶点5 %}。
删除{% label info @顶点5 %}，DAG中出度为 0 的顶点只有{% label danger @顶点4 %}。
删除{% label danger @顶点4 %}，DAG中出度为 0 的顶点只有{% label whatever @顶点6 %}。
删除{% label whatever @顶点6 %}，DAG中所有的顶点都输出了，拓扑排序完成。

因此，我们本轮得到的拓扑排序序列就是{% label warning @顶点1 %}、{% label primary @顶点2 %}、{% label success @顶点3 %}、{% label info @顶点5 %}、{% label danger @顶点4 %}、{% label whatever @顶点6 %}。
如果我们在一开始选择输出的节点是{% label primary @顶点2 %}，还可以得到别的结果。

{% endnote %}

