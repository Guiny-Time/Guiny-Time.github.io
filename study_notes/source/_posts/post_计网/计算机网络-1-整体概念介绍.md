---
title: 计算机网络(1)整体概念介绍
tags: ['计算机网络','计算机科学技术','面试相关']
categories: 计算机网络
date: '2024-03-11 19:05:58'
copyright_author: 时光
cover: geometry_glacier_httpss.mj.runswt2Oa1F9yI_a_man_in_19_standing__5ec542d1-feff-42e9-bb7c-14048fa4dbba.png
katex: true
hidden: true
---

# 计算机网络的概念及功能

<img src="https://img11.360buyimg.com/ddimg/jfs/t1/184415/38/42968/76339/65f183f7F4e35ca9b/03ea0efc07cb7122.jpg" width=500 alt="计算机网络" title="计算机网络" />

<!-- more -->

## 概念

> **计算机网络**（英语：computer network），通常也简称网络，是指容许节点分享资源的数字电信网络。在电脑网络，电脑设备会透过**节点**之间的连接（数据链路）互相交换数据，即收发（接收和发放）网络信息。

> A computer network is a **system** that connects two or more computing devices for transmitting and sharing information. Computing devices include everything from a mobile phone to a server. These devices are connected using physical wires such as fiber optics, but they can also be wireless.
"计算机网络是连接两台或多台计算设备以实现传输和共享信息目的的系统。计算设备包括手机、服务器等一系列设备，它们通过物理缆线（如光纤）或无线的方式相互连接。"

以上概念分别引自维基百科和Spiceworks，维基的叙述方式比较学术，其中的一些概念（比如节点）会在后续介绍到。总的来说，计算机网络是一个将分散的、具有独立功能的**计算机系统**，通过**通信设备**（如路由器、中继器、交换机）与**线路**（有线或无线）连接起来，由功能完善的**软件**实现 {% label success @资源共享 %} 和 {% label success @信息传递 %} 的系统。

{% note warning simple %}
为什么是由功能完善的软件实现资源共享和信息传递的呢？
{% endnote %}

计算机网络是一个互连的、自治的计算机集合。其中，
- **互连**：通过通信链路互联互通
- **自治**：无主从关系、各个终端高度自治

{% note warning 计算机网络的具体功能 %}
计算机网络系统有以下具体功能：
- **数据通信**：终端之间通过数据链路互相交换数据，即收发（接收和发放）网络信息。
- **资源共享**：同一个计算机网络上的其他计算机可以使用某台计算机的计算机资源的行为，可以共享硬件、软件、数据。
    - 硬件共享：使用学校的网络打印机
    - 软件共享：远程访问其他电脑，使用上面的软件（比如qq的远程控制）
    - 数据共享：云端数据库
- **分布式处理**：多台计算机各自承担同一工作任务的不同部分，使工作效率提高。
- **提高可靠性**：这是分布式处理的一个优点，如果网络中的一台主机宕机，集群中还有其他机器可以顶替其工作。
- **负载均衡**：这也是分布式处理的优点，可以让任务量分到多台计算机上。
{% endnote %}

## 饭后消遣：互联网的历史
美苏冷战时期，为防止苏联针对性的破坏主机，美国国防部想出了将主机分散到各地并使用链路链接起来共享数据的办法。在这种情况下，即使苏联炸毁了一台主机，其他主机也保存有重要的军事资料，这个系统被成为“**阿帕网**”（ARPAnet）。随着各地**网络**（net）逐渐出现，美国国防部最后接受了TCP/IP协议，将这些网络互连，**互联网**（internet）初具规模。在这个阶段：
网络把许多计算机连接在一起，而互联网则把许多网络连接在一起，**因特网**（Internet）是世界上最大的互联网。
- 网络：若干节点（如终端、交换机）、以及连接这些节点的链路
- 互联网：若干网络通过**路由器**连接在一起

1985年，美国简历了国家科学基金网，设计了计算机网络的三级结构。在美国的大部分学校以及研究所，如果用户想要连接到互连线，首先需要登录校园网或企业网，随后连接到地区网，再连接到主干网。

<img src="https://img12.360buyimg.com/ddimg/jfs/t1/90758/30/45069/22193/65f18c00F2cf091db/df76dd09e5179bf5.jpg" alt="三级结构" title="三级结构" />

再后来，随着互联网规模的壮大，美国将网络服务移交给了一些网络服务提供商（ISP）。ISP是一个向广大用户综合提供互联网接入业务、信息业务和增值业务的公司，分为主干ISP、地区ISP和本地ISP。我国有名的提供商有中国移动、中国联通、中国电信等。
而我们平常交的“网费”，其实就是给各ISP的服务费，以通过ISP申请到可以上网的IP地址。

<img src="https://img11.360buyimg.com/ddimg/jfs/t1/232181/22/15139/41646/65f18f47F69746809/e3ba03fb71a25846.jpg" alt="多层次ISP结构" title="多层次ISP结构" />

在多层次ISP结构中，有一个因特网交换点（IXP）的概念。IXP通过直接相连两个网络，允许用户AB通信时跳过图中的主干ISP。

这基本就是今天互联网的模型。互联网依然是若干网络通过**路由器**连接在一起组成的。

# 组成及分类
## 计算机网络的组成
计算机网络是由 {%label warning @硬件 %}、{%label warning @软件 %} 和 {%label warning @协议 %} 三大要素按照一系列规则和约定组成的集合。

{% note warning 硬件、软件和协议 %}
- **硬件**
各类端系统（终端）、路由器、交换机等；
- **软件**
附加在端系统上、或中间设备上的计算机程序；
- **协议**
软件通过协议传输数据，协议规定了数据在计算机网络中流通的规则。
{% endnote %}

而从**工作方式**上，可以把计算机网络分为{%label warning @边缘部分 %} 和 {%label warning @核心部分 %}。

{% note warning 边缘部分和核心部分 %}
- **边缘部分**
由各类端系统组成，包括计算机、摄像头、服务器等需要使用网络的终端，位于计算机网络系统的边缘。边缘系统通过以下方式实现通信：
    - **C/S方式**
    C/S 即 {%label info @Client%} 与 {%label info @Server %}，服务器与客户端，是最古老的一种通信方式。例如：当我们用qq发送消息时，我们的端系统（C）会先将消息发送给腾讯服务器（S），服务器处理完消息后再发送给接收人（C）。
    访问服务的人越多，服务就越慢。
    - **B/S方式**
    B/S 即 {%label info @Broswer %} 与 {%label info @Server %}。在这个场景中，客户端被换成了浏览器，其他部分与C/S相同。
    - **P2P**
    P2P 即 peer-to-peer ，{%label info @对等连接 %}。在这个模式中，端系统同时具有客户端与服务器的身份，可以彼此之间收发消息。在P2P网络中，主机的数量越多下载的速度就越快。
    <img src="https://www.researchgate.net/publication/238638509/figure/fig1/AS:392801603866627@1470662608756/Architecture-of-C-S-and-P2P.png" width=500 alt="C/S方式（左）与对等连接（右）" title="C/S方式（左）与对等连接（右）" />
    
- **核心部分**
为边缘部分提供服务，实现端与端之间的通信（即两个端系统之间的**进程之间的通信**）。其中包括路由器、中间设备等。
{% endnote %}

从**功能组成**上，可以把计算机网络分为负责**数据通信**的 {%label warning @通信子网 %} 和负责**资源共享**或**数据处理**的 {%label warning @资源子网 %} 两部分。

{% note warning 通信子网和资源子网 %}
在 {%label primary @OSI七层模型 %} 中，下三层（**网络层**、**数据链路层**、**物理层**）代表了 <u> 通信子网 </u>；上三层（**应用层**、**表示层**、**会话层**）代表了 <u> 资源子网 </u>。
> **通信子网**
    >- 由网络层的**路由器**、数据链路层的**交换机**和**网桥**、物理层的**集线器**和**中继器**组成。
    >- 具有传输、交换、控制和存储的能力，可以实现联网计算机之间数据的通信。

> **资源子网**
    >- 实现资源共享功能的设备和软件的集合。

{% endnote %}

## 计算机网络的分类
按照**分布范围**，计算机网络可以分成 {%label success @广域网/WAN %}、{%label success @城域网/MAN %} 、{%label success @局域网/LAN %} 和 {%label success @个人区域网/PAN %} 四种类型。

{% note warning 按照分布范围分类的四种计算机网络 %}
1. 广域网
使用交换技术（通过路由器等设备转发、存储、交换）。
覆盖范围是几十时到几千公里，是因特网的主要组成部分，允许跨国传输数据。
2. 城域网
可以覆盖一个城市的网络。
3. 局域网
使用广播技术。
在地理上范围比较小，比如一个学校、公司。
4. 个人区域网
使用无线技术。
十米左右，基本指的是在个人电子设备（如手机、手环）相互连接。
{% endnote %}

按照**使用者**区分，可以分成 {%label success @公用网 %} 和 {%label success @专用网 %} (如军队、政府等)。
按照**数据交换技术**区分，则可以分成 {%label success @电路交换 %} 、{%label success @报文交换 %} 和 {%label success @分组交换 %} 三种类型。

{% note warning 按照数据交换技术分类的三种计算机网络 %}
1. 电路交换
分为三个步骤（参考打电话）：建立连接、通话（期间一直占用连接，即**占线**）、释放连接。
2. 报文交换
使用了存储转发的技术，将报文传输给路由器A，再由路由器A根据最优路径原则转发给路由器B，最后转发到目的地。
3. 分组交换
与报文交换类似，其实“分组”就是将一整个完整的报文细分成小的“组”。
{% endnote %}

按照**拓扑结构**分类，还可以将网络分成 {%label success @总线型 %}、{%label success @星型 %} 、{%label success @环型 %} 和 {%label success @网状型 %}（广域网常用的拓扑结构） 等多种类型。在这种分类中，我们将端系统或路由器抽象成一个个**节点**、将通信链路抽象成**线**，二者相结合的结构就是网络的“**拓扑结构**”。

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/NetworkTopologies.svg/1200px-NetworkTopologies.svg.png" width=500 alt="几种不同的网络拓扑结构" title="几种不同的网络拓扑结构" />

最后，按照**传输技术**区分，可以分成 {%label success @广播式网络 %} 和 {%label success @点对点网络 %} 。

{% note warning 按照传输技术分类的两种计算机网络 %}
1. 广播式网络
共享公共通信信道，应用于局域网（通常使用总线型拓扑结构）。
2. 点对点网络
使用**分组存储转发**和**路由选择**机制，应用于广域网（需要众多节点实现这两个功能，因此是网状结构）。
{% endnote %}

# 标准化工作及相关组织
在计算机网络领域，标准化非常重要，不同的设备直接能够互相连接的基础就是公用一套相同的标准。标准主要有以下两类：
- **法定标准**
由权威机构制定的正式的、合法的标准，例如 {%label primary @OSI七层模型 %}。
- **事实标准**
约定俗成的标准，通常由科技巨头牵头形成，例如 {%label primary @TCP/IP模型 %}。

需要注意的是，所有因特网标准都是通过**RFC**（Request for comment）形式记录的。RFC是用来记录互联网规范、协议、过程等的标准文件，基本的互联网通信协议都有在RFC文件内详细说明。RFC中也有一些恶搞文档，比如“鸽联网”，那么RFC要怎么上升为真正的因特网正是标准呢？一般来说，需要经过以下五（四）个阶段：
1. **因特网草案**
在这个阶段还不是RFC文档，只是一个构思。完成构思后，作者需要将其发送至RFC编辑的邮箱中。
2. **建议标准**
当RFC编辑审核通过提案后，草案就成为了RFC文档，变成了“建议的标准”。
3. **请求评论**
这也是为什么该文档被称为“RFC”的原因。在这一阶段，文档被发布到论坛上，世界各地的人都可以对文档提出建议，完善标准。
4. **草案标准**（该阶段已与2011年取消）
最终，草案交由**IETF**与**IAB**两个国际组织进行审核。
5. **因特网标准**
审核通过后，草案成为了新的因特网标准！

{% note warning 与标准化工作相关的组织 %}
1. **国际标准化组织ISO**
最重要的组织，建立了OSI参考模型、HDLC协议。
2. **国际电信联盟ITU**
制定了通信规则。
3. **国际电气电子工程师学会IEEE**
是一个顶级学术机构，提出了IEEE802系列标准、5G标准协议等。
4. **互联网工程任务组IETF**
负责因特网相关标准的制定，例如前文的RFC草案审批。
{% endnote %}

# 性能指标
## 速率
**速率**，或称 **{%label danger @数据传输率 %}**、**{%label danger @比特率 %}**，是指连接在计算机网络上的 **主机** 在数字信道上传送数据 **位数的速率**。
> **比特**(bit)
比特是数据传输的**原子单位**，只有 1 和 0 两种形式，单位为“**位**（b）”。

比特率规定使用“**比特每秒**”（bit/s或bps）为单位，经常和国际单位制词头关联在一起，如“千”Kilo（kbit/s或kbps），“兆”Mega (百万)（Mbit/s或Mbps），“吉”Giga（Gbit/s或Gbps）和“太”Tera（Tbit/s或Tbps）。其中，相邻量级之间相差1000：

<img src="https://img12.360buyimg.com/ddimg/jfs/t1/244318/38/6081/8670/65f5aae7F2de8152c/7469f6263e4eaec6.jpg" alt="单位换算" title="单位换算" />

{% note warning 我怎么记得1MB=1024KB？ %}
容易产生这个混淆，是因为在**存储容量**领域中TB、GB、MB、KB、B确实是逐级相差1024（也就是2^10）倍的。
为啥呢？因为此“B”非彼“b”，存储容量中的“B”指的是Byte（字节），一个 Byte 包含了 8 个 bit（比特）。而之后的KB、MB、GB、...都是以“B”作为基础的。
而在**数据传输速率**上，你有没有发现所有单位的 b 都是**小写**的 b 呢？所以 1Kb 真的就是 1K 个 b ，也就是 1000b 的意思。
我们需要特别注意大小写的问题。

<img src="https://img12.360buyimg.com/ddimg/jfs/t1/238136/7/13949/8403/65f5ad5fF17b446c4/eea738fb4fec5eab.jpg" alt="存储容量单位" title="存储容量单位" />

{% endnote %}

## 带宽
**带宽**，在通信领域指某个**信号**具有的**频带宽度**，即最高频率与最低频率之差，单位是赫兹（Hz）。在计算机网络领域中，**带宽**指的则是网络的通信线路传送数据的能力，通常指单位时间内从网络中的某一点到另一点所能通过的“**{%label danger @最高数据率 %}**”，单位和速率一样。
从另一个角度说，带宽反映了网络设备所支持的**最高发送速度**。
链路带宽1Mb/s，代表主机在1秒的时间内可以发送1Mb数据（即1us内发送1bit数据）。

> **"发送速度"和"传输速度"并不相同！**
信息以电磁波的形式在链路中传播，而电磁波在链路中的传播速度为2 \* 10^8 m/s，该传输速度是恒定的。之所以比光速（3 \* 10^8 m/s）慢，是因为传播介质造成了损耗（并非在真空中传输）。在这个条件下，电磁波在1us的时间内可以传输200m。
带宽所表明的“**发送速度**”则代表主机在单位时间内能往链路上发送多少的数据量，或者说**{%label danger @最高数据率 %}**。

## 吞吐量
**吞吐量**表示在**单位时间**内通过某个**网络、信道或接口**的**数据量**，单位和速率以及带宽一样。
吞吐量受到带宽和速率的影响，具体表现在：
- 一条链路的带宽代表了吞吐量的上限；
- 吞吐量代表单位时间内通过链路的所有数据量，是单位时间内所有往主机发送数据的服务器的速率的和

## 时延
**时延**指的是**数据**（如报文/分组/比特流）从网络/链路的一端传送到另一端所需要的**时间**，也叫 *延迟* 或 *迟延*，单位为s。
时延分为以下四种，总时延为它们的和：
1. **发送时延**（传输时延）
    指从发送分组的第一个比特算起，到该分组的最后一个比特发送完成所需要的时间。
    **发送时延 = 数据量 / 发送速率**
    这代表如果有一组 200Mb 的数据待发送，但主机的速率只有 2Mbps，就需要 100 秒的时间才能发送完，这100s就是发送时延。最低发送时延的数值为数据量 / 信道带宽。
2. **传播时延**
    数据在链路上传播经过的时间。这段时间与电磁波的传播速度（常数，刚才介绍过了）和链路长度有关。
    **传播时延 = 链路长度 / 电磁波速度**
3. **排队时延**
    指的是数据等待输出/输入链路**可用**的等待时间。当数据到达用以转发数据的**路由器**时，由于一台路由器的处理能力有限，数据可能会被暂存在路由器的**缓冲**中。当数据进入路由器，排队就结束了。
    在下面的处理时延结束之后，数据可能要**等待输出链路可用**，这时候的等待时间仍属于排队时延。
4. **处理时延**
    数据进入路由器之后，路由器需要对数据进行**处理**，处理所花费的时间就是处理时延。处理的过程包括检查数据是否出错、为数据寻找传输出口等。

## 时延带宽积
**时延带宽积**又称为“**以比特为单位的链路长度**”，指的是**传播时延**与**带宽**的乘积，单位是bit。时延带宽积是一个描述**数据量**的性能属性，代表了某段链路现在有多少比特。
时延带宽积 = 传播时延 × 带宽
在公式中，传播时延的单位是s，带宽以bps作为单位。
<img src="https://img14.360buyimg.com/ddimg/jfs/t1/244876/6/5801/17539/65faf2fcFb5d98f00/c483363a8be522df.jpg" alt="image.png" title="image.png" />

## 往返时间RTT
往返时间RTT指的是从发送方**发送数据**开始，到发送方收到接收方的**确认**（接收方收到数据后立即发送确认）**总共经历的时延**。
RTT = 传播时延 * 2 + 末端处理时间
两倍的传播时延代表了**往返的传播时延**，末端处理时间则指的是**接收方对数据的处理时间**。
RTT越大，在收到确认之前可以发送的数据越多。这并不一定是件好事，比如在实时团队合作FPS游戏中，如果一个玩家与游戏服务器之间的RTT很大，在其他玩家眼里该玩家可能是在不断瞬移的。

## 利用率
**利用率**分为**信道利用率**和**网络利用率**。
- **信道利用率**
    信道利用率 = 信道上有数据通过的时间 / 总时间
- **网络利用率**
    网络利用率 = 所有信道的加权平均值

利用率与时延存在指数关系。当利用率接近最大时，信道也是非常拥堵的，导致时延增大。
<img src="https://img11.360buyimg.com/ddimg/jfs/t1/106751/18/39582/7284/65faf5eeFfa2417c0/98107564652b1386.jpg" width=300 alt="image.png" title="image.png" />

# 计算机网络的体系结构与参考模型
网络体系结构是从**功能**上描述计算机网络结构的。计算机网络体系结构是计算机网络的**各层及其协议**的集合。

## 分层结构
试想一下，在往另一台主机发送文件之前，发送方至少需要：
1. **激活**数据通信的通路；
2. 告诉网络如何识别目的（接收方）主机；
3. 查明接收方主机是否开机、网络链接是否正常；
4. 接收方计算机的文件管理程序是否已经做好接收文件的准备；
5. 确保差错和意外可以解决；
6. ......

如果我们能把“发送文件”这件事情拆成一个一个子问题去解决（分治思想），那么事情就会变得更好处理。在计算机网络中，我们为不同类型的事件划分了“层(layer)”的概念，每层通过特定的协议提供相应的服务，组成了**计算机网络体系结构**（即**分层结构**）。其中：
- 各层之间相互**独立**，每层只实现一种相对独立的功能
- 每层之间**界面自然清晰**，易于理解，相互交流尽可能少
- 结构上相互分离，每层都采用**最合适的技术**来实现
- 保持下层对上层的**独立性**，上层单向使用下层提供的服务
- 整个分层结构应该能促进**标准化工作**

<img src="https://img12.360buyimg.com/ddimg/jfs/t1/137113/27/38661/21207/66001d66F97c8cb9f/a19e2720b92fbc63.jpg" alt="image.png" title="image.png" />

{% note warning 一个寄快递的例子 %}
什么是**层**？什么是**协议**？什么是**服务**？这几个概念或许有点抽象，让我们用寄快递的例子模拟一下：
当我们决定寄快递时，我们先用泡沫塑料包裹货物、再用纸箱封装货物、最后贴上货运单寄出。
在货物运输到接收方之后，接收人根据货运单找到自己的包裹、拆开纸箱、掏出泡沫塑料，最后拿到货物。
在这个过程中，假设货物就是我们要发送的**文件**，则：
1. 泡沫塑料、纸箱、货运单分别对应三个“**层**”
2. 在每一层都存在活动元素，它们就是**实体**，例如货物、装了货物的箱子。在同一层的实体被称为**对等实体**。
3. 在每一层，我们都按照约定的规则（**协议**）处理货物，比如我们规定如何拆装纸箱、如何填写和核对货运单。协议只存在于对等实体当中，拿上面的例子来说，拆装纸箱的过程只能发送在纸箱上，而不能发生在泡沫塑料上。
4. **接口**位于层与层之间，有一定的逻辑。
5. **服务**存在于每两个层次之间，越底的层级为越高的层级提供**服务**，比方说：
    - 泡沫塑料为货物提供保护
    - 纸箱为泡沫塑料和货物提供容器
    - 货运单为纸箱提供收寄人信息，保证货物能发往正确的地方
{% endnote %}

## 协议、接口、服务
通过寄快递的例子，已经可以对计算机网络的结构有一个基本的认知了，现在让我们看看上图中的五层网络示意图，理解一下现实中的网络分层结构及其相关概念（{% label info @协议%}、{% label info @接口 %}、{% label info @服务 %}）吧。
1. **协议**
前文提到过，网络协议是为**同一层级**中的**对等实体**的数据交换而建立的规则、标准或约定。
协议分成三个部分：**语法**、**语义**和**同步**。
    - 语法
    规定传输数据的格式，例如数据如何分割，起止位置在哪等等
    - 语义
    规定所要完成的功能，定义数据段的含义
    - 同步
    规定各种操作的顺序，例如哪个数据报文先发送、哪个后发送
2. **接口(访问服务点SAP)**
接口也叫“访问服务点SAP”，是上层使用相邻的下层功能的入口，也是下层为上层提供**服务**的接口。
3. **服务**
服务指的是下层为相邻上层提供的功能调用。只有下层为上层提供服务，服务垂直存在于层之间。
需要注意的是，在第 n 层为第 n + 1 层提供服务时，此服务不仅包含第 n 层本身的功能，还包含由下层服务提供的功能。

在每一层中，数据以**PDU**（PCI+SDU）的方式存在。
- **SDU**不是山大，指的是**服务数据单元**（Service Data Unit），即为完成用户所要求的功能而应传输的数据（有用的部分，比如文件）。
- **PCI**指的是**协议控制信息**（Protocol Control Information），是控制协议操作的信息。
- PDU是PCI和SDU结合的整体，即**协议数据单元**（Protocol Data Unit），是对等层次之间以及往下层传递的**数据单元**。一个层级的PDU往下层传递之后，就会变成下一层的SDU（如下图所示）。

<img src="https://img12.360buyimg.com/ddimg/jfs/t1/137495/36/42788/11751/66002b25Fce38b2df/c641408ab5727207.jpg" width=300 alt="image.png" title="image.png" />

## OSI七层模型(法定)
IBM（国际商用机器公司）是第一个提出网络体系结构的公司。在其提出网络体系结构后，其他公司纷纷效仿，提出了自己的结构。毕竟有网络结构真的很方便，分治思想将大问题化小，减轻了开发人员的工作量。但很快人们就发现，不同公司奉行不同的网络体系结构，数据难以互通（像极了今天的各个平台的小程序），一套统一的标准急需建立。

<img src="https://img10.360buyimg.com/ddimg/jfs/t1/208987/22/31498/40890/660169edF321b9fd0/75b76036bcee55aa.jpg" alt="image.png" title="命运石之门中捏他IBM5100的IBN5100" />

为了支持**异构网络系统**的互通互联，**国际标准化组织**（ISO）于1984年正式提出**开放系统互连**（OSI）参考模型。不过，虽然理想很丰满，OSI七层模型在市场上却失败了（不敌竞争对手TCP/IP模型），主要原因有下：
1. OSI的协议比较复杂，运行效率低
2. OSI标准制定周期太长
3. OSI的层次划分不合理

虽然OSI模型并未被市场接受，但其理论价值还是有值得我们学习的地方。接下来，我们将分层简单介绍一下OSI七层模型。从底层到高层有一个有趣的记忆口诀：物联网淑慧试用。

<img src="https://img12.360buyimg.com/ddimg/jfs/t1/187324/21/42688/34037/66016c96Fbc9de3f4/490d6a1205734ab4.jpg" alt="image.png" title="image.png" />

在两台主机进行通信时，可能会经过一些中间系统（例如：位于网络层的**路由器**、位于数据链路层的**交换机**），这些中间系统会依照协议将数据一步步还原到自己所处的层，检查数据并重新一步步封装到物理层再次发送。

<img src="https://img12.360buyimg.com/ddimg/jfs/t1/103075/8/22936/48415/66016f1aFe588b2d2/68158f99014828da.jpg" alt="image.png" title="image.png" />

从上图中可以发现：中间设备不会使用到OSI模型中的**上四层**，只有收发主机接触到了它们。如果你还记得之前的笔记，上三层属于**资源子网**（我们暂时把第四层也并到其中），而下三层属于**通信子网**。在资源子网中，数据不经过中间设备处理，因此可以看作是**端到端**的。而通信子网则会接触到中间系统，每次指定下一个接受的系统的地址，因此可以看作是**点到点**的。

### 应用层（用）
应用层是直接面向用户的，是**用户与网络的界面**，代表了所有能和用户交互**产生网络流量**的**程序**（也就是说，这些程序需要连接网络才能正常使用）。
作为OSI七层模型的第一层，从这一层到会话层为止，我们都处在负责数据处理的**资源子网**。
典型的应用层服务协议有：
- 文件传输协议（FTP）
- 电子邮件（SMTP）
- 万维网(www)（HTTP）

### 表示层（试）
表示层负责处理在两个通信系统（设备）中**交换信息**的**表示方式**（处理语法和语义）。传输层具有以下功能：
1. 数据格式变换（翻译）
不同设备对于数据的编码模式可能不同，需要先变换数据格式。
2. 加密与解密
加密发送端的数据、解密接收端的数据，防止数据被抓包时泄露信息。
3. 压缩与解压
在传输数据的过程中，有时数据非常大，因此需要压缩发送端的数据，并在接收端接收时解压。

表示层在五层结构中往往被纳入应用层/会话层中。

### 会话层（慧）
会话层向表示层的实体/用户进程（正在运行的程序）提供**建立连接**并在连接上**有序**地**传输**数据。这就是会话，也就是**建立同步(SYN)**。
我们经常会听到“建立会话”、“发起会话”之类的词语，会话之间是彼此独立的，不会相互影响。
会话层的功能如下：
1. 建立、管理和终止会话。
2. 使用**校验点**可使会话在通信失效时从校验点/同步点继续恢复通信，实现数据同步。

典型的会话层协议有：
- 数据流协议（ADSP）
- ASP

{% note warning 校验点(checkpoint) %}
当我们要发送一段很长的会话时，会话层会往其中插入数个**校验点**。当网络不稳定导致会话被关闭时，会话可以恢复到上一个检验点的位置，等待网络恢复后继续通信。该系统的优点在于网络打断大文件传输时不用重新再传一次。
举个游戏中的例子，校验点就像死亡重生点。当玩家意外死亡或掉线时，可以从重生点复活继续游戏，而不用从头开始玩。
<img src="https://img11.360buyimg.com/ddimg/jfs/t1/227316/9/15814/20396/66017e92F99512473/df4ee8bfc4bad4eb.jpg" alt="image.png" title="image.png" />
{% endnote %}

### 传输层（淑）
传输层是自下而上，第一个面向端到端通信的层级，同时也是通信子网与资源子网的接口。
传输层负责主机中**两个进程**的通信，每个进程都有一个**端口号**，因此传输层即**端到端**的通信。传输单位是**报文段**或**用户数据报**。
传输层主要有以下几个功能：
1. 可靠传输、不可靠传输
对于一个较大的传输文件，我们将其切成报文段形式的原子单位进行发送。在**可靠传输**中：
    - 接收方接收到报文段后，反馈确认接收到的信息给发送端，发送端收到确认信息后再发送下一段报文
    - 如果发送完一段报文后，发送端迟迟未收到接收端的响应，它就会重新再发送一遍未收到确认反馈的报文段
而对于**不可靠传输**来说，发送端会直接发送所有的数据报，接收端在收到数据时也不会反馈确认信息。适用于小数据。
2. 差错控制
报文段出现丢失、乱序等问题时，传输层可以修正这些问题。
3. 流量控制
由于接收方的能力有限，有时需要控制发送端的发送速度。
4. 复用分用
根据进程的端口号进行报文段的区分，传输层可以实现以下两类功能：
    - **复用**：多个应用层进程可以同时使用传输层的服务。
    - **分用**：传输层把收到的信息分别交付给应用层中相应的进程。

传输层的主要协议有：
- 传输控制协议（TCP）
- 用户数据报协议（UDP）

### 网络层（网）
从这一层开始到最后一层都属于负责数据通信的**通信子网**。
网络层负责将**分组**从源端传送到目的端，为分组交换网络上的不同主机提供通信服务。网络层的传输单位依然是**数据报**。
当数据报过长的时候，网络层会将其切割为较小的**分组**进行传递。
网络层有以下几个功能：
1. 路由选择
在网络层中，有着数个路由器，它们形成了一个庞大的分组交换网络（也是一个带权无向图）。从A点到B点可以有数种路径，网络层需要根据实际状况选择最佳路径传输数据。
2. 流量控制
协调发送端的发送速度，确保接收端有条不紊地接收数据。
3. 差错控制
根据规则（如：**奇偶校验码**）检查收到的分组是否有错，如果可以纠错就纠错，如果不能纠错就舍弃，确保传输层提供的数据都是没有问题的。
4. 拥塞控制
拥塞控制不同于流量控制。在流量控制中，网络层限制了**发送端的发送速度**；而在拥塞控制中，网络层控制的则是宏观的**分组交换网络的传输速度**。当网络中的所有节点都来不及接受分组而要丢弃大量分组的话，就意味着该网络处于**拥塞状态**，需要采取措施缓解这种状态。

网络层的主要协议有：
- 网际协议（IP）
- 互联网分组交换协议（IPX）
- 互联网控制消息协议（ICMP）
- 互联网组管理协议（IGMP）
- 地址解析协议（ARP）
- 逆地址解析协议（RARP）
- 开放式最短路径优先（OSPF）

### 数据链路层（联）
数据链路层的主要任务是将网络层传下来的数据报**组装**成**帧**。因此，帧就是数据链路层的传输单位。
这一层最独特的地方在于：它不仅为网络层传输来的数据加上了头部PCI，还为其加上了尾部PCI。
数据链路层的主要功能如下：
1. 成帧（定义帧的开始和结束）
将网络层的数据报组装成帧，帧是一个比较长的比特流（由01组成），需要数据链路层定义开始与结束。
2. 差错控制
检查帧错或位错，改正或丢弃差错的帧。
3. 流量控制
控制发送方的发送速度。
4. 访问（接入）控制
控制对**信道**的访问。在广播式网络中，同一时间只有一台主机可以使用信道。

数据链路层的主要协议有：
- 同步数据链路控制（SDLC）
- 高级数据链路控制（HDLC）
- 点对点协议（PPP）
- 生成树协议（STP）

### 物理层（物）
作为承载信息传输的实体，可以是光纤、电缆等等。物理层不额外处理从数据链路层传输来的PDU，而是直接通过物理系统进行传输。
物理层将比特流转换成电信号或光信号等，在物理媒体上实现比特流的**透明传输**。
> **透明传输**
指不管所传数据是什么样的比特组合,都应当能够在链路上传输。

物理层的主要功能如下：
1. 定义接口特性
确定连接电缆的插口有多少引脚
2. 定义传输模式
- 单工：单向传输，只有一个发送方
- 半双工：双方都可以作为发送方，但同一时间只有一方可以发送
- 双工：双向同时传输
3. 定义传输速率
4. 比特同步
准确无误的发送
5. 比特编码
规定表示电压的方式

物理层的主要协议有：
- 水晶头接口（Rj45）
- 以太网（IEEE 802.3）

## TCP/IP四层模型(事实)

相比于OSI参考模型，TCP/IP模型只有四层，分别是：应用层、传输层、网际层和网络接口层。

<img src="https://images.shiksha.com/mediadata/ugcDocuments/images/wordpressImages/2022_03_OSI-Model-vs-TCP-IP-Model-Difference.jpg">
<img src="https://img14.360buyimg.com/ddimg/jfs/t1/196312/1/42417/51136/6602d97eF62aff87e/389917c03fe27257.jpg" alt="image.png" title="TCP/IP协议栈" />

与OSI七层模型对比，不难发现，TCP/IP模型与OSI模型都实现了以下功能：
- 分层
- 基于协议栈的概念
- 实现异构网络互联

TCP/IP的独特之处在于：
1. 在设计时着重考虑网络层的IP协议，由于该协议是**无连接**的，因此TCP/IP的网络层只有无连接的方式。
2. 在传输层，除了**面向连接**的方式之外，TCP/IP模型还有**无连接**的方式。

<img src="https://img13.360buyimg.com/ddimg/jfs/t1/101057/10/45516/9624/6602db90Fa3fd633d/2a1479aca65db1cc.jpg" width=300 alt="image.png" title="image.png" />

> **面向连接**与**无连接**
面向连接：建立连接、发送请求、连接成功-->发送数据-->发送成功、断开连接
无连接：直接发送数据

## 五层参考模型
五层参考模型结合了TCP/IP模型与OSI模型的优点，是一个通用的参考模型。它包括：应用层、传输层、网络层、数据链路层、物理层。可以看到，五层模型将TCP/IP模型的网络接口层重新拆开了，同时与TCP/IP模型一样合并了表示层和会话层。

在之后的章节中，我们会详细介绍五层模型中每一层的具体实现与相关协议。

<img src="https://ilabxp.com/wp-content/uploads/2019/07/asset-v1TUMxiLabx2T2019type@assetblock@week1-prelab-models.jpeg">

各层和其数据的表现形式如下所示：

<img src="https://img14.360buyimg.com/ddimg/jfs/t1/182536/40/43408/13507/6602dd4cF9f111c1b/9ffb53928b6c3a61.jpg" width=400 alt="image.png" title="image.png" />

| 复习周期 |   1d   |   2d   |   7d   |   21d  |
|  :----: | :----: | :----: | :----: | :----: |
|  /      |        |        |        |        |