---
layout: post
title: 传输层刷题笔记
date: 2024-12-05 14:14:31
tags:
categories: 计算机网络
hidden: true
---

{% note info **传输层的端到端逻辑通信** %}
传输层的端到端逻辑通信指的是**源主机和目的主机进程之间**的通信。
{% endnote %}

{% note info **传输层端口号范围** %}
熟知的端口号范围为 0 ~ 1023
更大的一般没有协议在用。
{% endnote %}

{% note info **无连接的可靠性保证** %}
需要上层提供可靠服务。例如无连接的UDP需要应用层来保证其可靠性。
{% endnote %}

{% note info **首部长度** %}
TCP首部长度20B，UDP首部长度8B
IP首部长度20B
{% endnote %}

{% note info **哪四种情况TCP会发送RST包** %}
1. 端口未打开
2. 请求超时
3. 提前关闭
4. 在一个已关闭的socket上收到数据
5. 用于拒绝一个非法连接     
{% endnote %}

---

{% note success **慢开始门限`ssthresh`与拥塞窗口`cwnd`** %}
拥塞窗口是任何时刻内确定能被发送出去的字节数的控制因素之一；慢开始门限用于区分**慢启动**和**拥塞避免**两个阶段。

当出现超时（网络出现严重阻塞）时，`ssthresh`减为`cwnd`的一半，`cwnd`会降为1个MSS，进入**慢启动**阶段。
当出现三次重复ACK（**快恢复**，即认为网络存在轻微拥塞）时，`ssthresh`减为`cwnd`的一半，`cwnd`**减半**而不是变为 1 MSS。

TCP 的原始设计理念是“谨慎假设网络状态”，因此`ssthresh`是保守的，不会变大，但`cwnd`是可以逐步增加的。在稳定网络中`cwnd`可以逐步增大，从而突破`ssthresh`的限制。
{% endnote %}

{% note success **拥塞窗口`cwnd`计算题** %}
两台主机之间建立了 TCP 连接，之后它们就开始通信。题目可能会告知发送方/接收方的拥塞窗口`cwnd`和TCP报文段最大长度`t`，问还能发多大字节。
**例如**：`t`最大为1000字节，发送方甲的`cwnd`为4000字节，发送两个最大包后收到乙的ACK包，告知其接收窗口还有2000字节，问甲最多还能向乙发多少字节的数据？
由题目可得，
- 甲发送大小1000的包1
- 甲发送大小1000的包2
- 乙传回包1的确认，说自己还有2000

当乙收到包2后，接收窗口就只剩1000了。因此甲最多还能向乙发1000字节的数据
{% endnote %}

{% note success **连接最大数据传输速率计算** %}
传输协议数据单元`TPDU`是传输层进行数据交换的基本单位，可以理解成TCP或UDP的报文段。
题目给出`TPDU`的最大尺寸、存活时间和序列号位数，该怎么计算每条连接的最大数据传输速率呢？
**例如**：`TPDU`的最大尺寸256B、存活时间20s，序列号位数8位
- 8位序列号代表范围是0 ~ 255
- 存活时间20s代表20s内发送的`TPDU`数量不能超过255个

所以最大数据速率为256*255*8/20=26112 bit/s
{% endnote %}

---

{% note danger **TCP的传输面向字节流** %}
TCP是面向字节流而不是报文段的。虽然TCP与UDP一样都是通过网络发送数据包，但工作方式并不相同。

TCP将应用层的数据看作一个连续的、无边界的字节流。TCP不关心应用程序发送的数据有多大，也不强制以某种固定大小分块传输，这意味着数据可能会被拆分成多个TCP段（**拆包**），也可能被多个数据块拼接在一个TCP段中（**粘包**）。
{% endnote %}